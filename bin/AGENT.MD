---
description: "Contexto bin - Binarios Compilados y Ejecutables"
agent: "Binary_Distribution"
capabilities: ["executable_distribution", "cross_compilation", "release_artifacts"]
triggers: ["build_success", "release_creation", "binary_deployment"]
---

# BIN - CONTEXTO DE CARPETA

## DESCRIPCI√ìN GENERAL
Esta carpeta contiene los binarios compilados de TRAE-CLI, incluyendo ejecutables para m√∫ltiples plataformas y configuraciones de distribuci√≥n.

## ARQUITECTURA DE BINARIOS

### Tipos de Binarios

#### Binarios de Release
- **trae**: Ejecutable principal de TRAE-CLI
- **trae.exe**: Versi√≥n Windows
- **trae-macos**: Versi√≥n macOS
- **trae-linux**: Versi√≥n Linux

#### Binarios de Desarrollo
- **trae-debug**: Versi√≥n con s√≠mbolos de debug
- **trae-dev**: Versi√≥n de desarrollo con features adicionales

#### Binarios de Testing
- **trae-test**: Binario instrumentado para testing
- **trae-bench**: Binario optimizado para benchmarks

### Estructura de Distribuci√≥n
```
bin/
‚îú‚îÄ‚îÄ linux/
‚îÇ   ‚îú‚îÄ‚îÄ x86_64/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trae
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trae.sha256
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trae.tar.gz
‚îÇ   ‚îî‚îÄ‚îÄ aarch64/
‚îÇ       ‚îú‚îÄ‚îÄ trae
‚îÇ       ‚îî‚îÄ‚îÄ trae.sha256
‚îú‚îÄ‚îÄ macos/
‚îÇ   ‚îú‚îÄ‚îÄ x86_64/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trae
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trae.sha256
‚îÇ   ‚îî‚îÄ‚îÄ aarch64/
‚îÇ       ‚îú‚îÄ‚îÄ trae
‚îÇ       ‚îî‚îÄ‚îÄ trae.sha256
‚îú‚îÄ‚îÄ windows/
‚îÇ   ‚îú‚îÄ‚îÄ x86_64/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trae.exe
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trae.exe.sha256
‚îÇ   ‚îî‚îÄ‚îÄ aarch64/
‚îÇ       ‚îú‚îÄ‚îÄ trae.exe
‚îÇ       ‚îî‚îÄ‚îÄ trae.exe.sha256
‚îî‚îÄ‚îÄ checksums.txt
```

## COMPILACI√ìN CROSS-PLATFORM

### Configuraci√≥n de Cross-Compilation
```toml
# Cross.toml - Configuraci√≥n para cross-rs
[target.x86_64-unknown-linux-gnu]
image = "rustembedded/cross:x86_64-unknown-linux-gnu"

[target.aarch64-unknown-linux-gnu]
image = "rustembedded/cross:aarch64-unknown-linux-gnu"

[target.x86_64-apple-darwin]
image = "rustembedded/cross:x86_64-apple-darwin"

[target.aarch64-apple-darwin]
image = "rustembedded/cross:aarch64-apple-darwin"

[target.x86_64-pc-windows-gnu]
image = "rustembedded/cross:x86_64-pc-windows-gnu"
```

### Script de Build Multiplataforma
```bash
#!/bin/bash
# scripts/build-release.sh

set -e

TARGETS=(
    "x86_64-unknown-linux-gnu"
    "aarch64-unknown-linux-gnu"
    "x86_64-apple-darwin"
    "aarch64-apple-darwin"
    "x86_64-pc-windows-gnu"
)

echo "üöÄ Building TRAE-CLI for multiple platforms..."

for target in "${TARGETS[@]}"; do
    echo "üì¶ Building for $target..."

    # Build with cross
    cross build --release --target $target

    # Determine output directory and binary name
    case $target in
        *-linux-*)
            bin_name="trae"
            platform="linux"
            ;;
        *-darwin)
            bin_name="trae"
            platform="macos"
            ;;
        *-windows-*)
            bin_name="trae.exe"
            platform="windows"
            ;;
    esac

    # Extract architecture
    arch=$(echo $target | cut -d'-' -f1)

    # Create output directory
    output_dir="bin/$platform/$arch"
    mkdir -p $output_dir

    # Copy binary
    cp "target/$target/release/$bin_name" "$output_dir/"

    # Generate checksum
    cd $output_dir
    sha256sum $bin_name > ${bin_name}.sha256
    cd - > /dev/null

    echo "‚úÖ Built for $target"
done

echo "üéâ All platforms built successfully!"
```

## OPTIMIZACIONES DE COMPILACI√ìN

### Release Profile Optimizado
```toml
# Cargo.toml - Perfil de release optimizado
[profile.release]
opt-level = 3
lto = true
codegen-units = 1
panic = "abort"
strip = true
debug = false

# Optimizaciones adicionales
[profile.release.package."*"]
opt-level = 3
```

### Link Time Optimization (LTO)
```bash
# Build con LTO completo
RUSTFLAGS="-C target-cpu=native" cargo build --release --config 'profile.release.lto="fat"'
```

### Binary Size Optimization
```bash
# Strip symbols para reducir tama√±o
strip target/release/trae

# Comprimir con UPX
upx --best --lzma target/release/trae
```

## DISTRIBUCI√ìN Y PAQUETES

### Paquetes .tar.gz
```bash
#!/bin/bash
# scripts/create-packages.sh

create_package() {
    local platform=$1
    local arch=$2
    local bin_name=$3

    echo "üì¶ Creating package for $platform-$arch..."

    cd bin/$platform/$arch

    # Create tarball
    tar -czf ${bin_name}.tar.gz $bin_name

    # Generate checksum for tarball
    sha256sum ${bin_name}.tar.gz > ${bin_name}.tar.gz.sha256

    cd - > /dev/null
}

# Create packages for all platforms
create_package "linux" "x86_64" "trae"
create_package "linux" "aarch64" "trae"
create_package "macos" "x86_64" "trae"
create_package "macos" "aarch64" "trae"
create_package "windows" "x86_64" "trae.exe"
```

### Checksums Globales
```bash
#!/bin/bash
# scripts/generate-checksums.sh

echo "üîê Generating global checksums..."

cd bin

# Find all binaries and generate checksums
find . -name "trae*" -type f -not -name "*.sha256" -not -name "*.tar.gz" | while read file; do
    sha256sum "$file" >> checksums.txt
done

echo "‚úÖ Checksums generated in bin/checksums.txt"
```

## INSTALACI√ìN Y DEPLOYMENT

### Script de Instalaci√≥n
```bash
#!/bin/bash
# install.sh

set -e

echo "üöÄ Installing TRAE-CLI..."

# Detect platform and architecture
detect_platform() {
    case "$(uname -s)" in
        Linux*)     platform="linux" ;;
        Darwin*)    platform="macos" ;;
        CYGWIN*|MINGW*|MSYS*) platform="windows" ;;
        *)          echo "Unsupported platform"; exit 1 ;;
    esac
}

detect_arch() {
    case "$(uname -m)" in
        x86_64)     arch="x86_64" ;;
        aarch64)    arch="aarch64" ;;
        arm64)      arch="aarch64" ;;
        *)          echo "Unsupported architecture"; exit 1 ;;
    esac
}

detect_platform
detect_arch

# Download appropriate binary
binary_url="https://github.com/organization/trae-cli/releases/latest/download/trae-${platform}-${arch}.tar.gz"
install_dir="/usr/local/bin"

echo "üì• Downloading TRAE-CLI for $platform-$arch..."
curl -L -o trae.tar.gz "$binary_url"

# Extract and install
tar -xzf trae.tar.gz
sudo mv trae "$install_dir/"

# Verify installation
if command -v trae &> /dev/null; then
    echo "‚úÖ TRAE-CLI installed successfully!"
    trae --version
else
    echo "‚ùå Installation failed"
    exit 1
fi
```

### Homebrew Formula
```ruby
# Formula/trae-cli.rb
class TraeCli < Formula
  desc "TRAE-CLI - Cargo extension for code analysis and repair"
  homepage "https://github.com/organization/trae-cli"
  url "https://github.com/organization/trae-cli/releases/download/v1.0.0/trae-macos-x86_64.tar.gz"
  sha256 "checksum_here"

  def install
    bin.install "trae"
  end

  test do
    system "#{bin}/trae", "--version"
  end
end
```

## TESTING DE BINARIOS

### Tests de Integraci√≥n
```rust
// tests/binary_integration_test.rs
#[test]
fn test_binary_execution() {
    // Build binary
    let output = Command::new("cargo")
        .args(&["build", "--release"])
        .output()
        .unwrap();
    assert!(output.status.success());

    // Test binary execution
    let binary_path = "target/release/trae";
    let output = Command::new(binary_path)
        .arg("--version")
        .output()
        .unwrap();

    assert!(output.status.success());
    let stdout = String::from_utf8(output.stdout).unwrap();
    assert!(stdout.contains("trae-cli"));
}

#[test]
fn test_cross_platform_binaries() {
    // Test that binaries exist for all platforms
    let platforms = ["linux", "macos", "windows"];
    let arches = ["x86_64", "aarch64"];

    for platform in &platforms {
        for arch in &arches {
            let bin_name = if *platform == "windows" { "trae.exe" } else { "trae" };
            let bin_path = format!("bin/{}/{}/{}", platform, arch, bin_name);
            assert!(Path::new(&bin_path).exists(), "Missing binary: {}", bin_path);
        }
    }
}
```

### Smoke Tests
```bash
#!/bin/bash
# scripts/smoke-test.sh

echo "üß™ Running smoke tests on binaries..."

platforms=("linux" "macos" "windows")
arches=("x86_64" "aarch64")

for platform in "${platforms[@]}"; do
    for arch in "${arches[@]}"; do
        echo "Testing $platform-$arch..."

        bin_name="trae"
        [ "$platform" = "windows" ] && bin_name="trae.exe"

        bin_path="bin/$platform/$arch/$bin_name"

        if [ ! -f "$bin_path" ]; then
            echo "‚ùå Binary not found: $bin_path"
            continue
        fi

        # Test basic functionality
        if "$bin_path" --version > /dev/null 2>&1; then
            echo "‚úÖ $platform-$arch: version check passed"
        else
            echo "‚ùå $platform-$arch: version check failed"
        fi

        # Test help command
        if "$bin_path" --help > /dev/null 2>&1; then
            echo "‚úÖ $platform-$arch: help command passed"
        else
            echo "‚ùå $platform-$arch: help command failed"
        fi
    done
done

echo "üéâ Smoke tests completed!"
```

## SEGURIDAD Y VERIFICACI√ìN

### Verificaci√≥n de Checksums
```bash
#!/bin/bash
# scripts/verify-checksums.sh

echo "üîê Verifying binary checksums..."

cd bin

# Verify individual checksums
find . -name "*.sha256" | while read checksum_file; do
    binary_file="${checksum_file%.sha256}"

    if sha256sum -c "$checksum_file"; then
        echo "‚úÖ $binary_file: checksum verified"
    else
        echo "‚ùå $binary_file: checksum verification failed"
        exit 1
    fi
done

echo "üéâ All checksums verified!"
```

### Firma de Binarios
```bash
# Firmar binarios con GPG
gpg --detach-sign --armor bin/linux/x86_64/trae

# Verificar firma
gpg --verify bin/linux/x86_64/trae.asc bin/linux/x86_64/trae
```

## INTEGRACI√ìN CON TRAE-CLI

### Comandos de Distribuci√≥n
```bash
# Construir todos los binarios
trae build --all-platforms

# Crear paquetes de distribuci√≥n
trae package --create

# Verificar integridad
trae verify --checksums

# Subir a releases
trae release --upload
```

### Configuraci√≥n de Build
```toml
# Cargo.toml - Configuraci√≥n de distribuci√≥n
[package.metadata.trae.distribution]
platforms = ["linux", "macos", "windows"]
architectures = ["x86_64", "aarch64"]
compression = "gzip"
signing = true
```

## CONTEXTO DE DESARROLLO

La carpeta bin/ contiene todos los artefactos de distribuci√≥n de TRAE-CLI. Gestiona compilaci√≥n multiplataforma, optimizaci√≥n de binarios y distribuci√≥n segura.

### Puntos de Contacto
- **CI/CD**: Genera binarios autom√°ticamente en releases
- **Cross-compilation**: Usa cross-rs para builds multiplataforma
- **Distribution**: Crea paquetes .tar.gz con checksums
- **Installation**: Scripts automatizados para instalaci√≥n

### Mejores Pr√°cticas
- Optimizar tama√±o de binarios con stripping y compresi√≥n
- Generar checksums SHA256 para verificaci√≥n
- Firmar binarios para distribuci√≥n segura
- Probar binarios en todas las plataformas objetivo
- Mantener versiones espec√≠ficas en subcarpetas
- Documentar proceso de instalaci√≥n claramente
- Usar LTO para optimizaci√≥n m√°xima
- Implementar smoke tests post-build
